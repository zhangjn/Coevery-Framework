@{
    Style.Require("jqGrid");
    Style.Require("jqGridCustom");
    Script.Require("jqGrid");
    Script.Require("jqGrid_i18n");
    Script.Require("moment");

    var gridPagerId = Model.GridId + "Pager";
}

<div id="filters" class="form-inline">
    <div class="searchbox">
        <label class="lb-80" for="FilterOptions_Search">@T("供应商名称:")</label>
        @Html.TextBox("FilterOptions.Search", null, new {@class = "text"})</div>
    <div class="searchbox">
        <label class="lb-50" for="FilterOptions_Contactor">@T("联系人:")</label>
        @Html.TextBox("FilterOptions.Contactor", null, new {@class = "text"})</div>
    <button type="submit" class="btn btn-small" id="btnFilter" name="submit.Filter" value="@T("Filter")"><i class="icos-looking-glass"></i>&nbsp;查找</button>
    <button type="reset" class="btn btn-small btnReset" id="btnReset" name="reset" value="清除">重置</button>
</div>
<div class="row-fluid">
    <table id="@Model.GridId"></table>
    <section id="@gridPagerId"></section>
</div>
@Html.AntiForgeryToken()

@using (Script.Foot())
{
    <script type="text/javascript">
        (function() {
            moment.lang('@WorkContext.CurrentCulture.ToLower()');

            function utcDateFormatter(cellvalue, options, rowObject) {
                if (cellvalue) {
                    return moment(cellvalue).format('l');
                } else {
                    return '';
                }
            }

            function utcDateTimeFormatter(cellvalue, options, rowObject) {
                if (cellvalue) {
                    return moment(cellvalue).format('l LT');
                } else {
                    return '';
                }
            }

            $.extend(jQuery.jgrid.defaults, {
                prmNames: {
                    page: 'page',
                    rows: 'pageSize',
                    sort: 'sortBy',
                    order: 'sortOrder'
                },
                datatype: 'json',
                mtype: 'POST',
                postData: {
                    __RequestVerificationToken: function() {
                        var magicToken = $("input[name=__RequestVerificationToken]").first();
                        if (magicToken.length == 0) {
                            return null;
                        } // no sense in continuing if form POSTS will fail
                        return magicToken.val();
                    }
                },
                viewrecords: true,
                height: '100%',
                pagerpos: 'right',
                recordpos: 'left',
                sortable: true,
                headertitles: true,
                multiselect: true,
                multiboxonly: true,
                autowidth: true,
                jsonReader: {
                    page: 'page',
                    total: 'totalPages',
                    records: 'totalRecords',
                    repeatitems: false
                }
            });

            var gridOptions = {
                url: '@Url.Action("List", "Supplier", new {area = "Coevery.PropertyManagement"})',
                colModel: [
                    { "name": "Name", "index": "Name", "label": "供应商名称", "sortable": true },
                    { "name": "Address", "index": "Address", "label": "地址", "sortable": true },
                    { "name": "Contactor", "index": "Contactor", "label": "联系人", "sortable": true },
                    { "name": "Tel", "index": "Tel", "label": "电话", "sortable": true },
                    { "name": "MobilePhone", "index": "MobilePhone", "label": "手机", "sortable": true },
                    { "name": "Email", "index": "Email", "label": "邮箱", "sortable": true },
                    { "name": "QQ", "index": "QQ", "label": "QQ号", "sortable": true },
                    { "name": "Fax", "index": "Fax", "label": "传真", "sortable": true },
                    { "name": "Description", "index": "Description", "label": "备注", "sortable": true },
                    { "name": "Id", "hidden": true, "key": true }
                ],
                pager: '#@gridPagerId',
                rowNum: 50,
                rowList: [50, 100, 150],
                sortname: '',
                sortorder: ''
            };

            @if (Model.GridOptions != null)
            {
                var json = Html.Raw(Json.Encode(Model.GridOptions));
                WriteLiteral("		$.extend(gridOptions, " + json + ");");
            }

            var grid = $('#@Model.GridId');

            grid.jqGrid(gridOptions);

            $('#btnFilter').click(function() {
                var postData = grid.jqGrid('getGridParam', 'postData');
                $('#filters :input').serializeArray().map(function(x) { postData[x.name] = x.value; });
                grid.trigger("reloadGrid");
            });

            $('#btnReset').click(function() {
                $('#FilterOptions_Search').val('');
                $('#FilterOptions_Contactor').val('');
                $('#btnFilter').trigger('click');
            });
        })();
    </script>
}